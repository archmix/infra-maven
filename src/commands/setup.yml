description: Setup maven

steps:
  - run:
      name: Echoing sonatype urls
      command: |
        echo "$SONATYPE_SNAPSHOT_URL"
        echo "$SONATYPE_RELEASE_URL"
  - run:
      name: Creating Settings file
      command: |
        cat > settings.xml \<<EOF
          <settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                        https://maven.apache.org/xsd/settings-1.0.0.xsd">
            <servers>
              <server>
                <id>ossrh</id>
                <username>${OSSRH_USER_NAME}</username>
                <password>${OSSRH_PASSWORD}</password>
              </server>
            </servers>
          </settings>
        EOF
  - run:
      name: Importing GPG Key
      command: |
        echo -e "$MAVEN_GPG_KEY" | gpg --import
        gpg --list-keys
  - run:
      name: Publish GPG Key
      command: |
        gpg --keyserver hkps://keys.openpgp.org --send-keys "$GPG_KEY_ID"
        gpg --keyserver hkps://keys.openpgp.org --recv-keys "$GPG_KEY_ID"
